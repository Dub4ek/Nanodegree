/*! FiveProject 2015-05-02 */
function initialize(){"use strict";var a={zoom:12,mapTypeId:google.maps.MapTypeId.SATELLITE,center:new google.maps.LatLng(55.752,37.615)};application.map=new google.maps.Map(document.getElementById("map-canvas"),a),application.map.setTilt(45),application.insertMyData(MY_PLACE_DATA),ko&&ko.applyBindings(application.viewModel)}var application=application||{},MOBILE_VIEW_WIDTH=768,MY_PLACE_DATA=[{title:"Theatre",position:{lat:55.656735,lon:37.540289}},{title:"Swimming pool",position:{lat:55.790413,lon:37.604194}},{title:"Football field",position:{lat:55.788657,lon:37.793652}},{title:"Park",position:{lat:55.78736,lon:37.818736}}];if(void 0===window.google){var errorSplash=document.getElementById("connection-error-splash");errorSplash&&(errorSplash.style.display="block");var navbar=document.getElementById("navbar");navbar&&(navbar.style.display="none")}else google.maps.event.addDomListener(window,"load",initialize);application.insertMyData=function(a){a.forEach(function(a){application.addMarker(a)})},application.addMarker=function(a,b){var c=new google.maps.Marker({position:new google.maps.LatLng(a.position.lat,a.position.lon),map:application.map,icon:"forsquare"===b?"src/img/forsquare.png":null,title:a.title,animation:google.maps.Animation.DROP});void 0!==b&&(c.specialFlag=b),google.maps.event.addListener(c,"click",function(){application.showInfoWindow(c)}),application.viewModel.places.push(c)},application.viewModel=new function(){var a=this;ko&&(a.places=ko.observableArray([]),a.showMarker=function(b,c){var d=ko.contextFor(c.target).$index(),e=a.places()[d];application.map.panTo(e.getPosition()),application.showInfoWindow(e)},a.searchPhrase=ko.observable(""),a.searchProcess=function(){var b=a.searchPhrase(),c=application.map.getCenter();b&&application.getFoursquareResponse(c.k,c.D,b,application.forsquareCallback)},a.resetData=function(){for(var b=application.viewModel.places(),c=0;c<b.length;c++)b[c].setMap(null);a.places.removeAll(),application.insertMyData(MY_PLACE_DATA)},a.windowWidth=ko.observable(window.innerWidth),a.windowHeight=ko.observable(window.innerHeight),a.mobileView=ko.computed(function(){return a.windowWidth()<MOBILE_VIEW_WIDTH}))},application.showInfoWindow=function(a){"use strict";function b(){return application.width<MOBILE_VIEW_WIDTH?"150x120":"320x200"}var c='<img src="http://maps.googleapis.com/maps/api/streetview?size={size}&location={location}" alt="{title}">';c=c.replace("{size}",b()),c=c.replace("{location}",a.getPosition().toString()),c=c.replace("{title}",a.title.replace(/"/g,"&quot;")),application.infoWindow&&application.infoWindow.close(),application.currentMarker&&application.currentMarker.setAnimation(null),application.infoWindow=new google.maps.InfoWindow({content:['<div style="text-align: center">',c,"<br>",a.title.replace(/"/g,"&quot;"),"</div>"].join("")}),google.maps.event.addListener(application.infoWindow,"closeclick",function(){application.currentMarker&&application.currentMarker.setAnimation(null)}),application.infoWindow.open(application.map,a),application.currentMarker=a,a.setAnimation(google.maps.Animation.BOUNCE)},application.getFoursquareResponse=function(a,b,c,d){"use strict";var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var a=JSON.parse(e.response);200===a.meta.code?d(a):console.log("ERROR in app.getFoursquareResponse: "+a.message)}},e.addEventListener("error",function(){alert("Unable to connect with Foursquare.com.")});var f=["https://api.foursquare.com/v2/venues/explore","?client_id=IZOLIHBJ212PETIENX1EMUT4BGZKLU4TRO1E0Z3LZ023XQLT","&client_secret=CQPVM2BW1Z4ESPDAMMS3X2H00RLRBYZFWP1XNVMOV5TTT5KN","&v=20130815","&ll=55.752,37.615","&radius=8000","&query="+c].join("");e.open("GET",f,!0),e.send()},application.forsquareCallback=function(a){"use strict";function b(){var a,b=application.viewModel.places();if(b)for(var c=0;c<b.length;c++)a=b[c],a.specialFlag&&(a.setMap(null),application.viewModel.places.remove(a))}var c=a.response.groups[0].items;b();for(var d=0;d<c.length;d+=1){var e={title:c[d].venue.name,icon:"icons/foursquare.png",position:{lat:c[d].venue.location.lat,lon:c[d].venue.location.lng}};application.addMarker(e,"forsquare")}},window.onresize=function(){application.viewModel.windowWidth(window.innerWidth),application.viewModel.windowHeight(window.innerHeight),application.width=window.innerWidth,application.height=window.innerHeight},application.width=window.innerWidth,application.height=window.innerHeight;